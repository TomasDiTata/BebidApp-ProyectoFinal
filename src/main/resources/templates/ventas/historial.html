<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Mis Compras</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/style.css}">
</head>
<body class="bg-light">

    <nav class="navbar navbar-dark bg-dark mb-4">
        <div class="container">
            <a class="navbar-brand fw-bold text-warning" th:href="@{/}">üç∫ BebidApp</a>
            <a th:href="@{/}" class="btn btn-outline-light btn-sm">Volver al Cat√°logo</a>
        </div>
    </nav>

    <div class="container py-4">
        <h2 class="mb-4"><i class="bi bi-bag-check-fill"></i> Mis Compras</h2>

        <div th:if="${ventas.empty}" class="alert alert-info text-center p-5 shadow-sm">
            <h4>A√∫n no has realizado ninguna compra.</h4>
            <p class="text-muted">¬°Nuestro cat√°logo te est√° esperando!</p>
            <a th:href="@{/}" class="btn btn-primary mt-3">Ir a comprar algo rico üòã</a>
        </div>

        <div class="accordion" id="accordionVentas" th:if="${!ventas.empty}">
            
            <div class="accordion-item" th:each="venta : ${ventas}">
                <h2 class="accordion-header" th:id="'heading' + ${venta.idVenta}">
                    <button class="accordion-button collapsed" type="button" 
                            data-bs-toggle="collapse" 
                            th:data-bs-target="'#collapse' + ${venta.idVenta}">
                        
                        <div class="d-flex justify-content-between w-100 me-3 align-items-center flex-wrap">
                            <span>
                                <strong>Pedido #<span th:text="${venta.idVenta}">123</span></strong>
                                <span class="badge bg-secondary ms-2" th:text="${#temporals.format(venta.fecha, 'dd/MM/yyyy HH:mm')}">Fecha</span>
                            </span>

                            <div class="text-end">
                                <span th:each="pago : ${venta.pagos}" class="badge bg-primary me-2">
                                    <i class="bi bi-credit-card"></i> <span th:text="${pago.metodoPago}">Efectivo</span>
                                </span>

                                <span class="text-success fw-bold fs-5" th:text="${'$ ' + venta.total}">$5000</span>
                            </div>
                        </div>
                    </button>
                </h2>
                
                <div th:id="'collapse' + ${venta.idVenta}" class="accordion-collapse collapse" data-bs-parent="#accordionVentas">
                    <div class="accordion-body bg-white">
                        <h6 class="text-muted border-bottom pb-2 mb-3">Detalle de productos</h6>
                        <div class="table-responsive">
                            <table class="table table-sm mb-0 align-middle">
                                <thead class="table-light">
                                    <tr>
                                        <th>Producto</th>
                                        <th class="text-center">Cant.</th>
                                        <th class="text-end">Precio Unit.</th>
                                        <th class="text-end">Subtotal</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="det : ${venta.detalles}">
                                        <td>
                                            <span th:text="${det.producto.nombre}">Coca Cola</span>
                                            <small class="text-muted d-block" th:text="${det.producto.categoria}">Cat</small>
                                        </td>
                                        <td class="text-center fw-bold" th:text="${det.cantidad}">2</td>
                                        <td class="text-end" th:text="${'$ ' + det.precioUnitario}">$1000</td>
                                        <td class="text-end fw-bold text-dark" th:text="${'$ ' + det.subtotal}">$2000</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>